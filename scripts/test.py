#!/usr/bin/env python
# coding=utf-8
import os
# import the necessary packages
import numpy as np
import cv2

image_path = "/home/nizar/Images/toto/"


def mse(imageA, imageB):
    # the 'Mean Squared Error' between the two images is the
    # sum of the squared difference between the two images;
    # NOTE: the two images must have the same dimension
    err = np.sum((imageA.astype("float") - imageB.astype("float")) ** 2)
    err /= float(imageA.shape[0] * imageA.shape[1])

    # return the MSE, the lower the error, the more "similar"
    # the two images are
    return err


cap = cv2.VideoCapture(1)

i = 0
toto, im_1 = cap.read()


def cmp():
    j = 0
    image_list = []
    for (dirpath, dirnames, filenames) in os.walk(image_path):
        for file in filenames:
            image_list.append(cv2.imread(os.path.join(dirpath, file)))
    for i in range(len(image_list)):
        im = image_list[i]
        for j in range(len(image_list)):
            print str(i) + " --> " + str(j) + " " + str(mse(im, image_list[j]))


# cmp()



"""" TEST AVEC DES IMAGES
0 --> 0 0.0
0 --> 1 3370.37143472
0 --> 2 3501.51035292
0 --> 3 3960.47495028
0 --> 4 3172.41881571
0 --> 5 3613.20017713
0 --> 6 4521.30262114
0 --> 7 3988.61298462
0 --> 8 3643.35602046
0 --> 9 3146.47641576
1 --> 0 3370.37143472
1 --> 1 0.0
1 --> 2 3043.82398946
1 --> 3 3364.08469261
1 --> 4 2999.55073574
1 --> 5 3004.19304573
1 --> 6 1854.03263703
1 --> 7 3466.69474658
1 --> 8 3018.03197727
1 --> 9 2582.49394797
2 --> 0 3501.51035292
2 --> 1 3043.82398946
2 --> 2 0.0
2 --> 3 3298.67522422
2 --> 4 2493.02093745
2 --> 5 2823.55313975
2 --> 6 3766.15764527
2 --> 7 3211.77718342
2 --> 8 1105.2015627
2 --> 9 2474.83882252
3 --> 0 3960.47495028
3 --> 1 3364.08469261
3 --> 2 3298.67522422
3 --> 3 0.0
3 --> 4 2889.0721726
3 --> 5 3365.60976383
3 --> 6 4176.14568394
3 --> 7 2872.93087344
3 --> 8 3410.84922656
3 --> 9 2958.94829089
4 --> 0 3172.41881571
4 --> 1 2999.55073574
4 --> 2 2493.02093745
4 --> 3 2889.0721726
4 --> 4 0.0
4 --> 5 2066.06102356
4 --> 6 3791.0953291
4 --> 7 2714.2860669
4 --> 8 2741.32214819
4 --> 9 1795.69477965
5 --> 0 3613.20017713
5 --> 1 3004.19304573
5 --> 2 2823.55313975
5 --> 3 3365.60976383
5 --> 4 2066.06102356
5 --> 5 0.0
5 --> 6 3886.30233518
5 --> 7 3327.72632928
5 --> 8 2857.53377764
5 --> 9 939.798614763
6 --> 0 4521.30262114
6 --> 1 1854.03263703
6 --> 2 3766.15764527
6 --> 3 4176.14568394
6 --> 4 3791.0953291
6 --> 5 3886.30233518
6 --> 6 0.0
6 --> 7 4362.99544538
6 --> 8 3757.14994946
6 --> 9 3383.25221643
7 --> 0 3988.61298462
7 --> 1 3466.69474658
7 --> 2 3211.77718342
7 --> 3 2872.93087344
7 --> 4 2714.2860669
7 --> 5 3327.72632928
7 --> 6 4362.99544538
7 --> 7 0.0
7 --> 8 3352.234269
7 --> 9 2946.70212481
8 --> 0 3643.35602046
8 --> 1 3018.03197727
8 --> 2 1105.2015627
8 --> 3 3410.84922656
8 --> 4 2741.32214819
8 --> 5 2857.53377764
8 --> 6 3757.14994946
8 --> 7 3352.234269
8 --> 8 0.0
8 --> 9 2529.87052196
9 --> 0 3146.47641576
9 --> 1 2582.49394797
9 --> 2 2474.83882252
9 --> 3 2958.94829089
9 --> 4 1795.69477965
9 --> 5 939.798614763
9 --> 6 3383.25221643
9 --> 7 2946.70212481
9 --> 8 2529.87052196
9 --> 9 0.0
10 --> 0 4530.38571609
10 --> 1 4098.91020609
10 --> 2 3973.6929919
10 --> 3 3994.40895656
10 --> 4 3634.93092665
10 --> 5 4104.53130832
10 --> 6 4948.03013589
10 --> 7 2736.64053413
10 --> 8 4082.65007414
10 --> 9 3642.27713366
"""
while True:
    ret, im = cap.read()

    cv2.imshow('video test', im)
    key = cv2.waitKey(10)
    print mse(im_1, im)
    im_1 = im
    if key == 32:
        print "save !!!!"
        cv2.imwrite(image_path + str(i) + ".jpg", im)
        i += 1
    if key == 107:
        cv2.destroyAllWindows()
        break
